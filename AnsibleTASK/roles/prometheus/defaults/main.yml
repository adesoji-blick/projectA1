---
# handlers file for roles/prometheus
- name: restart_prometheus
  systemd:
    name: prometheus
    state: restarted
    enabled: yes
    daemon_reload: yes

- name: reload_prometheus
  uri:
    url: http://localhost:9090/-/reload
    method: POST
    status_code: 200
[ec2-user@ip-172-31-8-44 handlers]$ cd ../files/
[ec2-user@ip-172-31-8-44 files]$ ls
[ec2-user@ip-172-31-8-44 files]$ cd ../defaults/
[ec2-user@ip-172-31-8-44 defaults]$ ls
main.yml
[ec2-user@ip-172-31-8-44 defaults]$ cat main.yml
---
# defaults file for roles/prometheus
prometheus_dir_configuration: "/etc/prometheus"
prometheus_retention_time: "365d"
prometheus_scrape_interval: "30s"
prometheus_node_exporter: true
prometheus_node_exporter_group: "all"
prometheus_env: "production"
prometheus_var_config:
  global:
    scrape_interval: "{{ prometheus_scrape_interval }}"
    evaluation_interval: 5s
    external_labels:
      env: '{{ prometheus_env }}'
  scrape_configs:
    - job_name: prometheus
      scrape_interval: 5m
      static_configs:
        - targets: ['{{ inventory_hostname }}:9090']
